# 核心同步和网络技术

预测回滚技术：        

上一帧权威状态+权威输入+预测输入=这一帧的最终状态  

上一帧权威状态+权威输入=这一帧的权威状态 

玩家的每一步操作都会作为预测输入储存在predictedInputList中并会立即执行此操作，每一帧服务器返回权威输入时将 predictedInputList中已经变成权威输入的预测输入移除，然后将客户端回滚至上一个确定的权威状态应用权威输入形成这一帧的权威状态再应用predictedInputList中所有的预测输入形成这一帧的最终状态 

##### 包压缩：
##### 前向纠错：
为了进一步提高传输速度，下层协议也许会使用前向纠错技术。需要注意，前向纠错会根据冗余信息解出原始数据包。相同的原始数据包不要两次input到KCP，否则将会导致 kcp以为对方重发了，这样会产生更多的ack占用额外带宽。

比如下层协议使用最简单的冗余包：单个数据包除了自己外，还会重复存储一次上一个数据包，以及上上一个数据包的内容：

Fn = (Pn, Pn-1, Pn-2)

P0 = (0, X, X)
P1 = (1, 0, X)
P2 = (2, 1, 0)
P3 = (3, 2, 1)
这样几个包发送出去，接收方对于单个原始包都可能被解出3次来（后面两个包任然会重复该包内容），那么这里需要记录一下，一个下层数据包只会input给kcp一次，避免过多重复ack带来的浪费。

